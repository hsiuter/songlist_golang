<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>歌單列表</title>
    <style>
        /* 在這裡添加CSS樣式 */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        .selected {
            background-color: #4CAF50; /* 绿色背景 */
            color: white;
        }
    </style>
</head>
<body>
    <h1>我的歌單</h1>
    <button id="chineseButton">中文</button>
    <button id="japaneseButton">日文</button>
    <button id="englishButton">英文</button>
    <input type="text" id="searchBox" placeholder="搜索歌名...">
    <table id="songlistTable">
        <thead>
            <tr>
                <th>歌單名稱</th>
                <th>歌手</th>
                <th>語言</th>
                <th>描述</th>
            </tr>
        </thead>
        <tbody>
            <!-- 歌單數據將在這裡顯示 -->
        </tbody>
    </table>

    <script>
        // 按钮元素
        const chineseButton = document.getElementById('chineseButton');
        const japaneseButton = document.getElementById('japaneseButton');
        const englishButton = document.getElementById('englishButton');

        // 按钮事件监听器
        chineseButton.addEventListener('click', () => toggleLanguageFilter('中文'));
        japaneseButton.addEventListener('click', () => toggleLanguageFilter('日文'));
        englishButton.addEventListener('click', () => toggleLanguageFilter('英文'));

        let selectedLanguage = '';

        function toggleLanguageFilter(language) {
            selectedLanguage = (selectedLanguage === language) ? '' : language;
            updateButtons();
            searchAndFilterSongs();
        }

        function updateButtons() {
            // 根据筛选状态更新按钮样式
            chineseButton.classList.toggle('button-selected', selectedLanguage === '中文');
            japaneseButton.classList.toggle('button-selected', selectedLanguage === '日文');
            englishButton.classList.toggle('button-selected', selectedLanguage === '英文');
        }

        function updateButtons() {
            // 更新按钮样式
            chineseButton.classList.toggle('selected', selectedLanguage === '中文');
            japaneseButton.classList.toggle('selected', selectedLanguage === '日文');
            englishButton.classList.toggle('selected', selectedLanguage === '英文');
        }   
    
        // 添加搜索事件监听器
        document.getElementById('searchBox').addEventListener('input', function(e) {
            searchSong(e.target.value);
        });
    
        // 定义全局变量来存储歌单数据
        let songlistData = [];
    
        // 定义搜索歌曲的函数
        function searchAndFilterSongs() {
            const searchText = document.getElementById('searchBox').value;
            let filteredData = songlistData;

            if (selectedLanguage) {
                filteredData = filteredData.filter(songlist => songlist.Language === selectedLanguage);
            }

            if (searchText) {
                filteredData = filteredData.filter(songlist => songlist.Name.includes(searchText));
            }

            displaySongs(filteredData);
        }

        // 修改现有的搜索事件监听器
        document.getElementById('searchBox').addEventListener('input', searchAndFilterSongs);
    
        // 修改原来的数据获取方法，以存储数据到全局变量
        fetch('/display-songlist', {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            songlistData = data; // 存储数据到全局变量
            displaySongs(data); // 显示数据
        })
        .catch(error => console.error('Error:', error));
    
        // 定义一个新函数来显示歌单
        function displaySongs(data) {
            const tableBody = document.getElementById('songlistTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = ''; // 清空现有数据
            data.forEach(songlist => {
                let row = tableBody.insertRow();
                row.insertCell(0).innerHTML = songlist.Name;
                row.insertCell(1).innerHTML = songlist.Singer;
                row.insertCell(2).innerHTML = songlist.Language;
                row.insertCell(3).innerHTML = songlist.Description;
            });
        }
    </script>
    
</body>
</html>
